import{r as $,V as p}from"./index-sRNqgdFD.js";let v={url:"wss://ws.nvdx.io/connection/websocket"},e=null;function S(b,a){e||(e=new Centrifuge(v.url,{token:localStorage.getItem("ws_token")}));const s=[],i=$();function r(o){try{if(!e||(e.on("connecting",function(n){console.log(`connecting: ${n.code}, ${n.reason}`)}).on("connected",function(n){console.log(`connected over ${n.transport}`)}).on("disconnected",function(n){console.log(`disconnected: ${n.code}, ${n.reason}`)}).on("error",function(n){console.log("client error",n)}).connect(),!o))return;l(o,a)}catch{}}function l(o,n,t=""){try{console.log("subUrl----------",o);const u={};if(t.length>0&&(u.token=t),i.value=e.newSubscription(o,u),console.log(i.value,1),!i.value)return;s.push(i.value),i.value.on("publication",function(c){n&&n(c)}).on("subscribing",function(c){console.log(`subscribing: ${c.code}, ${c.reason}`)}).on("subscribed",function(c){console.log("subscribed",c)}).on("unsubscribed",function(c){console.log(`unsubscribed: ${c}, ${c.reason}`)}).subscribe()}catch{}}r(b);function d(o){const n=s.findIndex(t=>t.channel===o);if(n!==-1){const t=s[n];t.unsubscribe(),s.splice(n,1),e.removeSubscription(t)}}function f(){s.forEach(o=>{o&&(o.unsubscribe(),e.removeSubscription(o))}),s.length=0}p(()=>{f()});function g(){e&&(e.disconnect(),e=null)}return{connectHandle:r,btcSub:i,setSub:l,unsubscribeChannel:d,unsubscribeAll:f,unConnectHandle:g}}export{S as u};
